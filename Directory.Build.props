<Project>
  <!-- Per Aspera SDK - AssemblyPublicizer Test Configuration -->
  
  <PropertyGroup>
    <SdkRoot>$(MSBuildThisFileDirectory)</SdkRoot>
    <IsCIBuild Condition="'$(GITHUB_ACTIONS)' == 'true'">true</IsCIBuild>
    <IsCIBuild Condition="'$(IsCIBuild)' == ''">false</IsCIBuild>
    
    <RestoreAdditionalProjectSources>https://nuget.bepinex.dev/v3/index.json</RestoreAdditionalProjectSources>
    
    <!-- Only pack PerAspera.ModSDK (main facade) and GameLibs, not sub-projects -->
    <PackageOutputPath>$(SdkRoot)..\Livrable\Nuggets</PackageOutputPath>
    <IsPackable Condition="'$(ProjectName)' == 'PerAspera.ModSDK' OR '$(ProjectName)' == 'PerAspera.GameLibs'">true</IsPackable>
    <IsPackable Condition="'$(ProjectName)' != 'PerAspera.ModSDK' AND '$(ProjectName)' != 'PerAspera.GameLibs'">false</IsPackable>
    
    <!-- Per Aspera Game Detection -->
    <PerAsperaGamePath Condition="'$(PerAsperaGamePath)' == '' AND Exists('F:\SteamLibrary\steamapps\common\Per Aspera')">F:\SteamLibrary\steamapps\common\Per Aspera</PerAsperaGamePath>
  </PropertyGroup>
  
  <!-- Modern AssemblyPublicizer for CI/CD -->
  <ItemGroup Condition="'$(IsCIBuild)' == 'true'">
    <PackageReference Include="BepInEx.AssemblyPublicizer.MSBuild" Version="0.4.2" PrivateAssets="all" />
  </ItemGroup>
  
  <!-- Reference game assemblies directly with auto-publicization -->
  <ItemGroup Condition="'$(IsCIBuild)' == 'true'">
    <Reference Include="$(PerAsperaGamePath)\Assembly-CSharp.dll" Publicize="true" />
    <Reference Include="$(PerAsperaGamePath)\ScriptsAssembly.dll" Publicize="true" />
    <Reference Include="$(PerAsperaGamePath)\BepInEx\interop\UnityEngine.CoreModule.dll" Publicize="true" />
    <Reference Include="$(PerAsperaGamePath)\BepInEx\interop\UnityEngine.IMGUIModule.dll" Publicize="true" />
    <Reference Include="$(PerAsperaGamePath)\BepInEx\interop\UnityEngine.dll" Publicize="true" />
    <Reference Include="$(PerAsperaGamePath)\BepInEx\interop\Il2Cppmscorlib.dll" Publicize="true" />
    <Reference Include="$(PerAsperaGamePath)\BepInEx\interop\Il2CppSystem.dll" Publicize="true" />
  </ItemGroup>
  
  <!-- Local development: use existing GameLibs -->
  <PropertyGroup Condition="'$(IsCIBuild)' != 'true'">
    <PerAsperaGameLibs>$(SdkRoot)GameLibs</PerAsperaGameLibs>
  </PropertyGroup>
  
  <!-- Game libraries are now consumed via NuGet package -->
  <!-- No longer need local GameLibs.props - using PerAspera.GameLibs NuGet package instead -->
  
</Project>